<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade Service - ลงทะเบียน</title>
    <link rel="stylesheet" href="style.css">
     <script src="https://static.line-scdn.net/liff/sdk/v2/liff.js "></script>
</head>
<body>
    <div class="container">
        <div class="status-bar">
            <div class="status-item active" id="status-register">ลงทะเบียน</div>
            <div class="status-item" id="status-pending">รอการตรวจสอบ</div>
            <div class="status-item" id="status-completed">เสร็จสิ้น</div>
        </div>

        <div class="content-section" id="register-section">
            <h2>ลงทะเบียนบริการ</h2>
            <p>กรุณาเชื่อมต่อ LINE เพื่อดำเนินการต่อ</p>
            <button class="line-login-btn" id="line-login-button">
                <img src="https://developers.line.biz/assets/img/og/line-login-btn-base.png" alt="LINE Login">
                ลงทะเบียนด้วย LINE
            </button>

            <div id="payment-section" style="display: none;">
                <h3>ชำระเงิน</h3>
                <p>สแกน QR Code เพื่อชำระเงินด้วยพร้อมเพย์</p>
                <div class="qr-code-placeholder">
                    <img src="https://i.postimg.cc/Dz7L0r5c/logo.png" alt="PromptPay QR Code">
                </div>
                <label for="slip-upload" class="upload-btn">อัปโหลดไฟล์สลิป</label>
                <input type="file" id="slip-upload" accept="image/*" style="display: none;">
                <span id="file-name-display">ยังไม่มีไฟล์ที่เลือก</span>

                <button class="register-submit-btn" id="submit-registration-button">ลงทะเบียน</button>
            </div>
        </div>
    </div>

    <script>

    // script.js
document.addEventListener('DOMContentLoaded', () => {
    const lineLoginButton = document.getElementById('line-login-button');
    const paymentSection = document.getElementById('payment-section');
    const statusRegister = document.getElementById('status-register');
    const statusPending = document.getElementById('status-pending');
    const statusCompleted = document.getElementById('status-completed');
    const slipUploadInput = document.getElementById('slip-upload');
    const fileNameDisplay = document.getElementById('file-name-display');
    const submitRegistrationButton = document.getElementById('submit-registration-button');

    let lineUserId = null; // To store LINE User ID

    // --- Function to update status bar ---
    function updateStatusBar(activeStatusId) {
        [statusRegister, statusPending, statusCompleted].forEach(item => {
            item.classList.remove('active');
        });
        document.getElementById(activeStatusId).classList.add('active');
    }

    // --- Initialize LINE SDK ---
    // Replace 'YOUR_CHANNEL_ID' with your actual LINE Login Channel ID
    // You need to create a LINE Login channel on LINE Developers console
    // and add 'http://localhost:5500/upgrade.html' (or your deployed URL) as a callback URL.
    liff.init({
        liffId: '2007333047-XVaQjnmO'
    }).then(() => {
        if (liff.isLoggedIn()) {
            liff.getProfile().then(profile => {
                lineUserId = profile.userId;
                console.log('LINE User ID:', lineUserId);
                // If already logged in, update UI
                lineLoginButton.textContent = 'LINE เชื่อมต่อสำเร็จ!';
                lineLoginButton.classList.add('success');
                lineLoginButton.disabled = true;
                paymentSection.style.display = 'block';
                updateStatusBar('status-register'); // Stay on register until submitted
            }).catch(err => console.error('Error getting LINE profile:', err));
        } else {
            console.log('Not logged in to LINE.');
        }
    }).catch(err => {
        console.error('LIFF initialization failed', err);
        alert('เกิดข้อผิดพลาดในการเริ่มต้น LINE SDK กรุณาลองใหม่ภายหลัง');
    });

    // --- LINE Login Button Click Handler ---
    lineLoginButton.addEventListener('click', () => {
        if (!liff.isLoggedIn()) {
            liff.login(); // This will redirect to LINE Login page
        }
    });
    </script>
    
</body>
</html>
